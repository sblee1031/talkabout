<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>Talk About</title>

<link rel="stylesheet" href="ta/css/nav.css" /> 
<link rel="stylesheet" href="ta/css/bootstrap.min.css" /> 

<!--jquery 스크립트-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    
       <!-- 로그인 js 시작 -->
    <meta
      name="google-signin-client_id"
      content="241916072602-heae1rac9sjh4t615b0k7i0iso0m842o.apps.googleusercontent.com"
    />
    <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>

<!-- TA로고 -->
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="assets/img/favicon.ico"
    />


</head>


<body>

<div id="wrapper">

    <div id="header">
    	<nav class="nav" >
			<a class="navMain" href="http://localhost:8888/ta_front/index.html"> Talk About </a>
			<ul class="nav">
				<li class=""><a class=""
					href="http://localhost:8888/ta_front/notice.html">공지사항</a></li>
				<li class=""><a class=""
					href="http://localhost:8888/ta_front/board.html">자유게시판</a></li>
				<li class=""><a class=""
					href="http://localhost:8888/ta_front/debrecruit.html">토론 모집</a></li>
				<li class=""><a class=""
					href="http://localhost:8888/ta_front/debbattle.html">토론 배틀</a></li>
				<li class=""><a class=""
					href="http://localhost:8888/ta_front/debresult.html">토론 결과</a></li>
			</ul>
					
			<!-- modal 시작 -->

				<!-- Button trigger modal -->
				<button type="button" id="myBtn" class="login btn btn-primary"
					data-toggle="modal" data-target="#exampleModal">로그인</button>

				<!-- Modal -->
				<div class="modal fade" id="exampleModal" tabindex="-1"
					aria-labelledby="exampleModalLabel" aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="exampleModalLabel">로그인 해주세요.</h5>
								
							</div>
							<div class="modal-body">

								<!-- 소셜계정 선택 시작 -->
								<div id="social"
									style="text-align: center; margin-block: inherit">
									<li id="GgCustomLogin" style="list-style-type: none"><a
										href="javascript:void(0)"> <!--  <button onclick="init()"> -->
											<!-- <p id="my-signin2"></p> --> <img style="width: 220px"
											src="assets/img/loginbt_google.png">
									</a></li> <br /> <a id="kakao-login-btn"></a>
									<!-- <button class="api-btn" onclick="unlinkApp()">앱 탈퇴하기</button> -->
									<br />

								</div>

								<!-- 소셜계정 선택 끝 -->

							</div>
							<div class="modal-footer">
							<button type="button" id="adminLogin" class="btn btn-info"
									>관리자</button>
								<button type="button" id="modalClose" class="btn btn-secondary"
									data-dismiss="modal">Close</button>

							</div>
						</div>
					</div>
				</div>

				<!-- 로고인 완료 화면 시작 -->
				<div id="memberinfo" style="display: none">
					<ul>
						<li style="list-style-type: none"><img class="rounded-circle"
							style="width: 30px" id="login_thumb_img" src="" alt="mythumbnail" />
							<span id="member_nickname" style="font-size: 10pt"></span></li>

					</ul>
					<button class="myinfo btn btn-primary" onclick="myinfo()"
						style="margin-right: 5px">마이페이지</button>
					<button class="logout btn btn-success" onclick="logout()">로그아웃</button>
				</div>

			</nav>
    </div>

    <div id="container">
		
		<section id="section" style="text-align: center; padding-bottom:70px; position:relative; ">

			<div class= "container" style="margin-top:3%; margin-bottom: 5%;">
				<h2 style="text-align: center;">자유게시판</h2>
					<div style="overflow-y:auto;">
					<!-- href = "./boardwrite.html"  -->
					<div style="text-align:right">
					<a  class="board_write btn btn-sm btn-outline-primary" style="position: relative; ">글쓰기</a>
					</div>
						<table class="table table-hover" style="text-align:center; margin-top: 10px">
							<thead>
								<tr class="table-primary">
									<th style="width:10%;">번호</th>
									<th style="width:20%;">타입</th>
									<th style="width:40%;">제목</th>
									<th style="width:10%;">닉네임</th>
									<th style="width:10%;">날짜</th>
									<th style="width:10%;">조회수</th>
								</tr>
							</thead>
							<tbody id="view">
								 <tr class="data1" style="display:none">
									<td class="board_no" style= "width:5%;"></td>
									<td class="board_type"></td>
									<td class="board_title" id="trigger" style="cursor: pointer;"></td>
									<td class="board_mem"></td>
									<td class="board_date"></td>
									<td class="board_views"></td>
								</tr>
							</tbody>
						</table>
						
						<table class="clone" style="display:none">
						<thead></thead>
							<tbody id="view" style="display:none">
								 <tr class="data1" style="display:none">
									<td class="board_no" style= "width:5%;"></td>
									<td class="board_type"></td>
									<td class="board_title" style="cursor: pointer;"></td>
									<td class="board_mem"></td>
									<td class="board_date"></td>
									<td class="board_views"></td>
								</tr>
							</tbody>
						</table>
						<input type=text size=15 class="board_search_contents input-sm" name="contents" style="margin-left: -435px;"/>
						<input type=submit value="검색" name="search" class="board_search btn btn-sm btn-primary" style="text-align:left"/>
						<div style="display: inline-block; margin-left: 240px">
						<div style="padding: 10px 45px;"id="paging"></div>
						
						</div>
					</div>
			</div>

		</section>

	</div>

    <footer id="footer">
    			<div>
			<a>Copyright ⓒ </a><a
				class="navbar-brand text-success logo h1 align-self-center">
				Talk About </a><br>
			<a>경기도 성남시 분당구 성남대로 34 하나프라자 6층</a>
		</div>
    </footer>

</div>
 <script>
     var totalData;    // 총 데이터 수
     var dataPerPage = 5;    // 한 페이지에 나타낼 데이터 수
     var pageCount = 5;        // 한 화면에 나타낼 페이지 수
     
     function paging(totalData, dataPerPage, pageCount, currentPage){
         
         console.log("currentPage : " + currentPage);
         
         var totalPage = Math.ceil(totalData/dataPerPage);    // 총 페이지 수
 		console.log('토탈페이지 :'+totalPage);
         var pageGroup = Math.ceil(currentPage/pageCount);    // 페이지 그룹
         
         console.log("pageGroup : " + pageGroup);
         
         var last = pageGroup * pageCount;    // 화면에 보여질 마지막 페이지 번호
         if(last > totalPage)
             last = totalPage;
         var first = last - (pageCount-1);    // 화면에 보여질 첫번째 페이지 번호
 		if(first<1)
 		first = 1;
         var next = last+1;
         var prev = first-1;
         
         console.log("last : " + last);
         console.log("first : " + first);
         console.log("next : " + next);
         console.log("prev : " + prev);
  
         var $pingingView = $("#paging");
         
         var html = "<ul class='pagination'>";
         
         if(prev > 0)
             html += "<li class='page-item'><a class='page-link' href=# id='prev'><</a> </li>";
         
         for(var i=first; i <= last; i++){
             html += "<li class='page-item'><a class='page-link' href='#' id=" + i + ">" + i + "</a> </li>";
         }
         
         if(last < totalPage)
             html += "<li class='page-item'><a class='page-link' href=# id='next'>></a> </li></ul>";
         
         $("#paging").html(html);    // 페이지 목록 생성
         $("#paging a").css("color", "black");
         $("#paging a#" + currentPage).css({"text-decoration":"none", 
                                            "color":"red", 
                                            "font-weight":"bold"});    // 현재 페이지 표시
                                            
         $("#paging a").click(function(){//페이지 번호 클릭시 렌더링 코드
             
             var $item = $(this);
             var $id = $item.attr("id");
             var selectedPage = $item.text();
             
             if($id == "next")    selectedPage = next;
             if($id == "prev")    selectedPage = prev;
             
             paging(totalData, dataPerPage, pageCount, selectedPage);
			
             
             $.ajax({
                 url:'http://localhost:9999/ta_back/board/list?pageNo='+selectedPage+'&pageSize=5',
     			method: 'get',
     			success:function(responseObj){
     				console.log('selectedPage',selectedPage );
     				totalData=responseObj.lastRow;
     				paging(totalData, dataPerPage, pageCount, selectedPage);
     				response=responseObj;
                     var table = $('table.table');
                     var tbody = $('table.table > #view');
                   	 
                     var $tr10bj = $('table.clone > #view >tr.data1');
                     
                     tbody.empty();
                     var lists = response.boardlist;
                     var nick_list = responseObj.nicklist;
                     $(lists).each(function(i,e){
                   	//console.log("인덱스", i);
     				var $copyObj = $tr10bj.clone();
     				/* var lines = e.lines; //게시글 정보
     				var lineSize = lines.length; */
     				//게시글 번호 , 타입 , 제목, 작성자, 날짜, 조회수
     				//console.log(e.board_no);
     					
     				$copyObj.find('td.board_no').html(e.board_no);
     				$copyObj.find('td.board_type').html(e.board_type);
     				$copyObj.find('td.board_title').html(e.board_title);
     				//$copyObj.find('td.board_title').attr('class',e.board_no);
     				
     				$copyObj.find('td.board_mem').html(e.board_member.member_nickName);
     				$copyObj.find('td.board_date').html(e.board_date);
     				$copyObj.find('td.board_views').html(e.board_views);
     				
     				$copyObj.show();
     				tbody.append($copyObj);
     			 });
                     
                 },
                 xhrFields:{
     				withCredentials:true
     			},
             });
             
             
             
         });// $("#paging a") 끝.
                                            
     }
     var totalData;    // 총 데이터 수
     var dataPerPage = 5;    // 한 페이지에 나타낼 데이터 수
     var pageCount = 5;        // 한 화면에 나타낼 페이지 수
     
     function paging(totalData, dataPerPage, pageCount, currentPage){
         
         console.log("currentPage : " + currentPage);
         
         var totalPage = Math.ceil(totalData/dataPerPage);    // 총 페이지 수
 		console.log('토탈페이지 :'+totalPage);
         var pageGroup = Math.ceil(currentPage/pageCount);    // 페이지 그룹
         
         console.log("pageGroup : " + pageGroup);
         
         var last = pageGroup * pageCount;    // 화면에 보여질 마지막 페이지 번호
         if(last > totalPage)
             last = totalPage;
         var first = last - (pageCount-1);    // 화면에 보여질 첫번째 페이지 번호
 		if(first<1)
 		first = 1;
         var next = last+1;
         var prev = first-1;
         
         console.log("last : " + last);
         console.log("first : " + first);
         console.log("next : " + next);
         console.log("prev : " + prev);
  
         var $pingingView = $("#paging");
         
         var html = "<ul class='pagination'>";
         
         if(prev > 0)
             html += "<li class='page-item'><a class='page-link' href=# id='prev'><</a> </li>";
         
         for(var i=first; i <= last; i++){
             html += "<li class='page-item'><a class='page-link' href='#' id=" + i + ">" + i + "</a> </li>";
         }
         
         if(last < totalPage)
             html += "<li class='page-item'><a class='page-link' href=# id='next'>></a> </li></ul>";
         
         $("#paging").html(html);    // 페이지 목록 생성
         $("#paging a").css("color", "black");
         $("#paging a#" + currentPage).css({"text-decoration":"none", 
                                            "color":"red", 
                                            "font-weight":"bold"});    // 현재 페이지 표시
                                            
         $("#paging a").click(function(){//페이지 번호 클릭시 렌더링 코드
             
             var $item = $(this);
             var $id = $item.attr("id");
             var selectedPage = $item.text();
             
             if($id == "next")    selectedPage = next;
             if($id == "prev")    selectedPage = prev;
             
             paging(totalData, dataPerPage, pageCount, selectedPage);
			
             var word = $('input.board_search_contents').val();
             $.ajax({
                 url:'http://localhost:9999/ta_back/board/list/'+word+'?pageNo='+selectedPage+'&pageSize=5',
     			method: 'get',
     			success:function(responseObj){
     				console.log('selectedPage',selectedPage );
     				totalData=responseObj.lastRow;
     				paging(totalData, dataPerPage, pageCount, selectedPage);
     				response=responseObj;
                     var table = $('table.table');
                     var tbody = $('table.table > #view');
                   	 
                     var $tr10bj = $('table.clone > #view >tr.data1');
                     var $cloneTbody= $('#clone');
                     tbody.empty();
                     var lists = response.boardlist;
                     var nick_list = responseObj.nicklist;
                     $(lists).each(function(i,e){
                   	//console.log("인덱스", i);
     				var $copyObj = $tr10bj.clone();
     				/* var lines = e.lines; //게시글 정보
     				var lineSize = lines.length; */
     				//게시글 번호 , 타입 , 제목, 작성자, 날짜, 조회수
     				//console.log(e.board_no);
     					
     				$copyObj.find('td.board_no').html(e.board_no);
     				$copyObj.find('td.board_type').html(e.board_type);
     				$copyObj.find('td.board_title').html(e.board_title);
     				//$copyObj.find('td.board_title').attr('class',e.board_no);
     				
     				$copyObj.find('td.board_mem').html(e.board_member.member_nickName);
     				$copyObj.find('td.board_date').html(e.board_date);
     				$copyObj.find('td.board_views').html(e.board_views);
     				
     				$copyObj.show();
     				tbody.append($copyObj);
     			 });
                     
                 },
                 xhrFields:{
     				withCredentials:true
     			},
             });
             
             
             
         });// $("#paging a") 끝.
                                            
     }
     
     
     //DOM시작
         $(function(){
            $('#copytable').hide();
    	    $('#copytbody').hide();

            //게시글 목록
            $.ajax({
                url:'http://localhost:9999/ta_back/board/list?pageNo=1&pageSize=5',
    			method: 'get',
    			success:function(responseObj){
    				console.log('response',responseObj );
    				totalData=responseObj.lastRow;
    				paging(totalData, dataPerPage, pageCount, 1);
    				response=responseObj;
                    var table = $('table.table');
                    var $tr10bj = $('table.table > tbody >tr.data1');
                    var lists = response.boardlist;

                    var nick_list = responseObj.nicklist;
                    $(lists).each(function(i,e){
    				var $copyObj = $tr10bj.clone();
    				/* var lines = e.lines; //게시글 정보
    				var lineSize = lines.length; */
    				//게시글 번호 , 타입 , 제목, 작성자, 날짜, 조회수
    				//console.log(e.board_no);
    					
    				$copyObj.find('td.board_no').html(e.board_no);
    				$copyObj.find('td.board_type').html(e.board_type);
    				$copyObj.find('td.board_title').html(e.board_title);
    				//$copyObj.find('td.board_title').attr('class',e.board_no);
    				
    				$copyObj.find('td.board_mem').html(e.board_member.member_nickName);
    				$copyObj.find('td.board_date').html(e.board_date);
    				$copyObj.find('td.board_views').html(e.board_views);
    				
    				$copyObj.show();
    				table.append($copyObj);
    			 });
                },
                xhrFields:{
    				withCredentials:true
    			},
            });
            //return false;
            //게시글 목록 ajax 끝

            //게시글 상세보기
            $('table.table').on('click', 'td.board_title', function(){
                var board_no = $(this).parent().find("td.board_no").html();
                var com_board = board_no;
                //게시글 번호 확인 alert => alert("board_no = " + board_no);
                var htmlurl = './boardinfo.html';
    			      var backurl = 'http://localhost:9999/ta_back/board/'+ board_no;

                $.ajax({
                    url: backurl,
                    method: 'get',
                    success: function(responseObj){
                        var board = responseObj.board;
                        var memberlist = responseObj.memberlist;
                        console.log(memberlist);
                        var htmlurl = './boardinfo.html';
                        $('section').load(htmlurl, function() {
                        
                          
                          if(memberlist == null){
                        	  $('td a.board_delete').hide();
                              $('td a.board_edit').hide();
                          }else if(memberlist.member_nickName != board.board_member.member_nickName){
                        	  $('td a.board_delete').hide();
                              $('td a.board_edit').hide();
                          }else if(memberlist.member_nickName == board.board_member.member_nickName){
                        	  $('td a.board_delete').show();
                              $('td a.board_edit').show();
                          }
                          $('td.board_no').html(board.board_no);
                          $('td.board_type').html(board.board_type);
                          $('td.board_title').html(board.board_title);
                          $('td.board_contents').html(board.board_contents);
                          $('td.board_mem').html(board.board_member.member_nickName);
                          $('td.board_date').html(board.board_date);
                          $('td.board_views').html(board.board_views); 
                          $('td.boardlike').html(board.boardlike_count);
                          $('div.boardinfo').show();
    		          		
                          $.ajax({
                              url:'http://localhost:9999/ta_back/boardcomment/list/' + com_board,
                              method: 'get',
                              success: function(responseObj){
                                  var comlists = responseObj.boardcommentlist;
                                  var memberlist = responseObj.memberlist;
                                  var table = $('#comment');
                                  var $tr20bj = $('tr.data2');
                                  console.log(comlists);
                                  
                                  console.log(memberlist); 
                                  $(comlists).each(function(i,e){
                                  	var $comcopyObj = $tr20bj.clone();
                                  	
                                  	$comcopyObj.find('td.com_no').html(e.com_no);
                                      $comcopyObj.find('td.com_contents').html(e.com_contents);
                                      $comcopyObj.find('td.com_mem').html(e.com_member.member_nickName);
                                      $comcopyObj.find('td.com_date').html(e.com_date);
                                   	if(memberlist == null){
             	                            console.log(e.com_member.member_nickName);
             	                            $comcopyObj.find('td input.com_delete_button').hide();
                                  	} else if(memberlist.member_nickName != e.com_member.member_nickName){
                                  		console.log(e.com_member.member_nickName);
                                  		$comcopyObj.find('td input.com_delete_button').hide();
                                  	} else if(memberlist.member_nickName == e.com_member.member_nickName){
                                  		$comcopyObj.find('td input.com_delete_button').show();
                                  	}
                                   	$comcopyObj.show();
                                   	table.append($comcopyObj);
                                  	
                                  });
                              },
                              xhrFields:{
                                  withCredentials:true
                              },
                          });
                        });
                    },
                    xhrFields:{
    				          withCredentials:true
    			          },
                });
                //return false;
                //게시글 상세보기 ajax 끝

                
                
                //조회수 증가 ajax
                var board_no = $(this).parent().find("td.board_no").html();
                var backurl = 'http://localhost:9999/ta_back/board/boardviewcount/'+ board_no;
                $.ajax({
                    url: backurl,
                    method: 'put',
                    success:function(responseObj){
                        //console.log('조회수 : '+responseObj);
                    },
                    xhrFields:{
                        withCredentials:true
                    },
                });
                //return false;
           });
            
            //게시글 검색
            $('input.board_search').on('click', function(){
            	var word = $('input.board_search_contents').val();
            	console.log(word);
            	
            	 $.ajax({
                     url:'http://localhost:9999/ta_back/board/list/'+word+'?pageNo=1&pageSize=5',
         			method: 'get',
         			success:function(responseObj){
         				console.log('response',responseObj );
         				totalData=responseObj.lastRow;
         				paging(totalData, dataPerPage, pageCount, 1);
         				response=responseObj;
                         var table = $('table.table');
                         var tbody = $('table.table > #view');
						 var $tr10bj = $('table.clone > #view >tr.data1');
                         tbody.empty();
                         var lists = response.boardlist;
                         var nick_list = responseObj.nicklist;
                        
                         	$(lists).each(function(i,e){
                 				var $copyObj = $tr10bj.clone();
                 				/* var lines = e.lines; //게시글 정보
                 				var lineSize = lines.length; */
                 				//게시글 번호 , 타입 , 제목, 작성자, 날짜, 조회수
                 				//console.log(e.board_no);
                 				$copyObj.find('td.board_no').html(e.board_no);
                 				$copyObj.find('td.board_type').html(e.board_type);
                 				$copyObj.find('td.board_title').html(e.board_title);
                 				//$copyObj.find('td.board_title').attr('class',e.board_no);
                 				
                 				$copyObj.find('td.board_mem').html(e.board_member.member_nickName);
                 				$copyObj.find('td.board_date').html(e.board_date);
                 				$copyObj.find('td.board_views').html(e.board_views);
                 				
                 				$copyObj.show();
                 				table.append($copyObj);
                 			 });
                        
                         
                     },
                     xhrFields:{
         				withCredentials:true
         			},
                 });
            });
           
            //return false;
            //게시글 검색 끝
            
           $('.board_write').on('click', function(){
        	   var html = './boardwrite.html';
        	   $('section').load(html, function(){
        	   });
        	   
           });
         });
     </script>
<script src="ta/js/bootstrap.min.js"></script>
<script src="assets/js/login1.js"></script>
	<script src="https://apis.google.com/js/platform.js?onload=init" async
		defer></script>
</body>

</html>